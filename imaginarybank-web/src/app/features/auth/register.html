<div class="min-h-screen flex justify-content-center p-4">
  <p-card header="Onboarding / Registro" styleClass="w-full lg:w-40rem">
    <p-steps [model]="steps" [activeIndex]="activeIndex"></p-steps>
    <p-divider></p-divider>

    <!-- STEP 0: CONTACT + KYC -->
    <form *ngIf="activeIndex === 0" [formGroup]="contactForm" class="flex flex-column gap-3">

      <div class="grid">
        <div class="col-12 md:col-6">
          <label class="block mb-2">Email</label>
          <input pInputText type="email" class="w-full" formControlName="email" />
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Teléfono</label>
          <input pInputText type="text" class="w-full" formControlName="phone" />
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Cédula (National ID)</label>
          <input pInputText type="text" class="w-full" formControlName="national_id" />
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Fecha expedición</label>
          <p-datepicker
            formControlName="national_id_issue_date"
            dateFormat="yy-mm-dd"
            [showIcon]="true"
            inputId="issueDate"
            class="w-full">
          </p-datepicker>
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Código dactilar</label>
          <input pInputText type="text" class="w-full" formControlName="fingerprint_code" />
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Ingreso mensual</label>
          <p-inputNumber formControlName="monthly_income" class="w-full" [min]="0" mode="decimal"></p-inputNumber>
        </div>

        <div class="col-12">
          <label class="block mb-2">Ocupación</label>
          <p-select
            class="w-full"
            [options]="occupationOptions"
            optionLabel="label"
            optionValue="value"
            formControlName="occupation_type">
          </p-select>
        </div>
      </div>

      <p-divider></p-divider>

      <div class="grid">
        <div class="col-12 md:col-6">
          <label class="block mb-2">Cédula frontal (imagen)</label>
          <p-fileUpload
            mode="basic"
            chooseLabel="Seleccionar"
            [auto]="false"
            [customUpload]="true"
            accept="image/*"
            (onSelect)="onIdSelected($event)">
          </p-fileUpload>
          <small class="block mt-2 text-600" *ngIf="idFile">Archivo: {{ idFile.name }} ({{ idFile.size }} bytes)</small>
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Selfie (imagen)</label>
          <p-fileUpload
            mode="basic"
            chooseLabel="Seleccionar"
            [auto]="false"
            [customUpload]="true"
            accept="image/*"
            (onSelect)="onSelfieSelected($event)">
          </p-fileUpload>
          <small class="block mt-2 text-600" *ngIf="selfieFile">Archivo: {{ selfieFile.name }} ({{ selfieFile.size }} bytes)</small>
        </div>
      </div>

      <div class="flex justify-content-end gap-2">
        <button pButton type="button" label="Cancelar" class="p-button-secondary" (click)="goLogin()" [disabled]="busy"></button>
        <button
          pButton
          type="button"
          label="Continuar"
          (click)="startIntent()"
          [disabled]="contactForm.invalid || busy || !idFile || !selfieFile">
        </button>
      </div>

      <p class="text-600 mt-2 mb-0" *ngIf="busy">Procesando…</p>
    </form>

    <!-- STEP 1: ACTIVATE -->
    <form *ngIf="activeIndex === 1" [formGroup]="activateForm" class="flex flex-column gap-3">

      <div class="grid">
        <div class="col-12">
          <label class="block mb-2">Nombre completo</label>
          <input pInputText class="w-full" formControlName="full_name" />
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Cédula/RUC (TIN)</label>
          <input pInputText class="w-full" formControlName="tin" />
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">Fecha de nacimiento</label>
          <p-datepicker
            formControlName="birth_date"
            dateFormat="yy-mm-dd"
            [showIcon]="true"
            inputId="birthDate"
            class="w-full">
          </p-datepicker>
        </div>

        <div class="col-12 md:col-6">
          <label class="block mb-2">País (ISO-3166-1 alpha-2)</label>
          <input pInputText class="w-full" formControlName="country" />
        </div>
      </div>

      <div class="flex align-items-center gap-2">
        <p-checkbox binary="true" formControlName="accepted"></p-checkbox>
        <span>Acepto términos, privacidad y tratamiento de datos.</span>
      </div>

      <div class="flex justify-content-between gap-2">
        <button pButton type="button" label="Atrás" class="p-button-secondary" (click)="back()" [disabled]="busy"></button>
        <button pButton type="button" label="Activar" (click)="activate()" [disabled]="activateForm.invalid || busy"></button>
      </div>

      <p class="text-600 mt-2 mb-0" *ngIf="busy">Procesando…</p>
    </form>
  </p-card>
</div>
